{% extends "base.html" %}

{% block title %}Settings - Cybersecurity AI System{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h1 class="mb-4">
            <i class="fas fa-cog"></i> System Settings
        </h1>
    </div>
</div>

<!-- General Settings -->
<div class="row mb-4">
    <div class="col-md-6">
        <div class="card card-enhanced">
            <div class="card-header">
                <h5><i class="fas fa-sliders-h"></i> General Settings</h5>
            </div>
            <div class="card-body">
                <form id="generalSettingsForm">
                    <div class="mb-3">
                        <label for="systemName" class="form-label">System Name</label>
                        <input type="text" class="form-control" id="systemName" value="Cybersecurity AI System">
                    </div>
                    
                    <div class="mb-3">
                        <label for="timezone" class="form-label">Timezone</label>
                        <select class="form-select" id="timezone">
                            <option value="UTC" selected>UTC</option>
                            <option value="EST">Eastern Time</option>
                            <option value="PST">Pacific Time</option>
                            <option value="GMT">Greenwich Mean Time</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="language" class="form-label">Language</label>
                        <select class="form-select" id="language">
                            <option value="en" selected>English</option>
                            <option value="es">Spanish</option>
                            <option value="fr">French</option>
                            <option value="de">German</option>
                        </select>
                    </div>
                    
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="autoRefresh" checked>
                        <label class="form-check-label" for="autoRefresh">
                            Auto-refresh dashboard
                        </label>
                    </div>
                    
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="darkMode">
                        <label class="form-check-label" for="darkMode">
                            Dark mode
                        </label>
                    </div>
                    
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Save General Settings
                    </button>
                </form>
            </div>
        </div>
    </div>
    
    <div class="col-md-6">
        <div class="card card-enhanced">
            <div class="card-header">
                <h5><i class="fas fa-shield-alt"></i> Security Settings</h5>
            </div>
            <div class="card-body">
                <form id="securitySettingsForm">
                    <div class="mb-3">
                        <label for="sessionTimeout" class="form-label">Session Timeout (minutes)</label>
                        <input type="number" class="form-control" id="sessionTimeout" value="30" min="5" max="480">
                    </div>
                    
                    <div class="mb-3">
                        <label for="maxLoginAttempts" class="form-label">Max Login Attempts</label>
                        <input type="number" class="form-control" id="maxLoginAttempts" value="5" min="3" max="10">
                    </div>
                    
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="require2FA">
                        <label class="form-check-label" for="require2FA">
                            Require Two-Factor Authentication
                        </label>
                    </div>
                    
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="passwordComplexity" checked>
                        <label class="form-check-label" for="passwordComplexity">
                            Enforce password complexity
                        </label>
                    </div>
                    
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="auditLogging" checked>
                        <label class="form-check-label" for="auditLogging">
                            Enable audit logging
                        </label>
                    </div>
                    
                    <button type="submit" class="btn btn-warning">
                        <i class="fas fa-shield-alt"></i> Save Security Settings
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Detection Settings -->
<div class="row mb-4">
    <div class="col-md-6">
        <div class="card card-enhanced">
            <div class="card-header">
                <h5><i class="fas fa-search"></i> Detection Settings</h5>
            </div>
            <div class="card-body">
                <form id="detectionSettingsForm">
                    <div class="mb-3">
                        <label for="detectionSensitivity" class="form-label">Detection Sensitivity</label>
                        <select class="form-select" id="detectionSensitivity">
                            <option value="low">Low</option>
                            <option value="medium" selected>Medium</option>
                            <option value="high">High</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="scanInterval" class="form-label">Scan Interval (seconds)</label>
                        <input type="number" class="form-control" id="scanInterval" value="60" min="10" max="3600">
                    </div>
                    
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="realTimeDetection" checked>
                        <label class="form-check-label" for="realTimeDetection">
                            Enable real-time detection
                        </label>
                    </div>
                    
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="autoBlock" checked>
                        <label class="form-check-label" for="autoBlock">
                            Auto-block malicious IPs
                        </label>
                    </div>
                    
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="emailAlerts" checked>
                        <label class="form-check-label" for="emailAlerts">
                            Send email alerts
                        </label>
                    </div>
                    
                    <button type="submit" class="btn btn-info">
                        <i class="fas fa-cog"></i> Save Detection Settings
                    </button>
                </form>
            </div>
        </div>
    </div>
    
    <div class="col-md-6">
        <div class="card card-enhanced">
            <div class="card-header">
                <h5><i class="fas fa-robot"></i> AI Assistant Settings</h5>
            </div>
            <div class="card-body">
                <form id="aiSettingsForm">
                    <div class="mb-3">
                        <label for="aiResponseMode" class="form-label">Response Mode</label>
                        <select class="form-select" id="aiResponseMode">
                            <option value="detailed" selected>Detailed</option>
                            <option value="concise">Concise</option>
                            <option value="technical">Technical</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="aiConfidence" class="form-label">Confidence Threshold</label>
                        <input type="range" class="form-range" id="aiConfidence" min="0.1" max="1.0" step="0.1" value="0.7">
                        <div class="d-flex justify-content-between">
                            <small>Low (0.1)</small>
                            <small>High (1.0)</small>
                        </div>
                    </div>
                    
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="aiLearning" checked>
                        <label class="form-check-label" for="aiLearning">
                            Enable learning from interactions
                        </label>
                    </div>
                    
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="aiContext" checked>
                        <label class="form-check-label" for="aiContext">
                            Maintain conversation context
                        </label>
                    </div>
                    
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="aiSuggestions" checked>
                        <label class="form-check-label" for="aiSuggestions">
                            Show response suggestions
                        </label>
                    </div>
                    
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-brain"></i> Save AI Settings
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Notification Settings -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card card-enhanced">
            <div class="card-header">
                <h5><i class="fas fa-bell"></i> Notification Settings</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4">
                        <h6>Email Notifications</h6>
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" id="emailThreats" checked>
                            <label class="form-check-label" for="emailThreats">
                                Threat Detection
                            </label>
                        </div>
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" id="emailSystem" checked>
                            <label class="form-check-label" for="emailSystem">
                                System Alerts
                            </label>
                        </div>
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" id="emailReports">
                            <label class="form-check-label" for="emailReports">
                                Daily Reports
                            </label>
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <h6>Browser Notifications</h6>
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" id="browserThreats" checked>
                            <label class="form-check-label" for="browserThreats">
                                Threat Detection
                            </label>
                        </div>
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" id="browserSystem">
                            <label class="form-check-label" for="browserSystem">
                                System Alerts
                            </label>
                        </div>
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" id="browserUpdates">
                            <label class="form-check-label" for="browserUpdates">
                                System Updates
                            </label>
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <h6>Alert Levels</h6>
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" id="alertCritical" checked>
                            <label class="form-check-label" for="alertCritical">
                                Critical Alerts
                            </label>
                        </div>
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" id="alertHigh" checked>
                            <label class="form-check-label" for="alertHigh">
                                High Priority
                            </label>
                        </div>
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" id="alertMedium">
                            <label class="form-check-label" for="alertMedium">
                                Medium Priority
                            </label>
                        </div>
                    </div>
                </div>
                
                <div class="mt-3">
                    <button type="button" class="btn btn-primary" onclick="saveNotificationSettings()">
                        <i class="fas fa-save"></i> Save Notification Settings
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- System Information -->
<div class="row">
    <div class="col-12">
        <div class="card card-enhanced">
            <div class="card-header">
                <h5><i class="fas fa-info-circle"></i> System Information</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <table class="table table-borderless">
                            <tr>
                                <td><strong>System Version:</strong></td>
                                <td>v2.1.0</td>
                            </tr>
                            <tr>
                                <td><strong>Last Updated:</strong></td>
                                <td>2024-01-15</td>
                            </tr>
                            <tr>
                                <td><strong>Database Version:</strong></td>
                                <td>SQLite 3.42.0</td>
                            </tr>
                            <tr>
                                <td><strong>Python Version:</strong></td>
                                <td>3.10.0</td>
                            </tr>
                        </table>
                    </div>
                    <div class="col-md-6">
                        <table class="table table-borderless">
                            <tr>
                                <td><strong>Flask Version:</strong></td>
                                <td>3.1.2</td>
                            </tr>
                            <tr>
                                <td><strong>TensorFlow Version:</strong></td>
                                <td>2.15.0</td>
                            </tr>
                            <tr>
                                <td><strong>Scikit-learn Version:</strong></td>
                                <td>1.3.2</td>
                            </tr>
                            <tr>
                                <td><strong>System Status:</strong></td>
                                <td><span class="badge bg-success">Operational</span></td>
                            </tr>
                        </table>
                    </div>
                </div>
                
                <div class="mt-3">
                    <button type="button" class="btn btn-outline-primary" onclick="exportSettings()">
                        <i class="fas fa-download"></i> Export Settings
                    </button>
                    <button type="button" class="btn btn-outline-secondary" onclick="importSettings()">
                        <i class="fas fa-upload"></i> Import Settings
                    </button>
                    <button type="button" class="btn btn-outline-danger" onclick="resetSettings()">
                        <i class="fas fa-undo"></i> Reset to Defaults
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Alert Container -->
<div id="alertContainer" class="position-fixed top-0 end-0 p-3" style="z-index: 9999;"></div>
{% endblock %}

{% block extra_scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    loadSettings();
    setupEventListeners();
});

function loadSettings() {
    // Load saved settings from localStorage
    const settings = JSON.parse(localStorage.getItem('system_settings') || '{}');
    
    // Apply settings to form elements
    Object.keys(settings).forEach(key => {
        const element = document.getElementById(key);
        if (element) {
            if (element.type === 'checkbox') {
                element.checked = settings[key];
            } else {
                element.value = settings[key];
            }
        }
    });
}

function setupEventListeners() {
    // General settings form
    document.getElementById('generalSettingsForm').addEventListener('submit', function(e) {
        e.preventDefault();
        saveGeneralSettings();
    });
    
    // Security settings form
    document.getElementById('securitySettingsForm').addEventListener('submit', function(e) {
        e.preventDefault();
        saveSecuritySettings();
    });
    
    // Detection settings form
    document.getElementById('detectionSettingsForm').addEventListener('submit', function(e) {
        e.preventDefault();
        saveDetectionSettings();
    });
    
    // AI settings form
    document.getElementById('aiSettingsForm').addEventListener('submit', function(e) {
        e.preventDefault();
        saveAISettings();
    });
    
    // Dark mode toggle
    document.getElementById('darkMode').addEventListener('change', function() {
        toggleDarkMode(this.checked);
    });
}

function saveGeneralSettings() {
    const settings = {
        systemName: document.getElementById('systemName').value,
        timezone: document.getElementById('timezone').value,
        language: document.getElementById('language').value,
        autoRefresh: document.getElementById('autoRefresh').checked,
        darkMode: document.getElementById('darkMode').checked
    };
    
    saveSettings(settings);
    showAlert('success', 'General settings saved successfully!');
}

function saveSecuritySettings() {
    const settings = {
        sessionTimeout: document.getElementById('sessionTimeout').value,
        maxLoginAttempts: document.getElementById('maxLoginAttempts').value,
        require2FA: document.getElementById('require2FA').checked,
        passwordComplexity: document.getElementById('passwordComplexity').checked,
        auditLogging: document.getElementById('auditLogging').checked
    };
    
    saveSettings(settings);
    showAlert('success', 'Security settings saved successfully!');
}

function saveDetectionSettings() {
    const settings = {
        detectionSensitivity: document.getElementById('detectionSensitivity').value,
        scanInterval: document.getElementById('scanInterval').value,
        realTimeDetection: document.getElementById('realTimeDetection').checked,
        autoBlock: document.getElementById('autoBlock').checked,
        emailAlerts: document.getElementById('emailAlerts').checked
    };
    
    saveSettings(settings);
    showAlert('success', 'Detection settings saved successfully!');
}

function saveAISettings() {
    const settings = {
        aiResponseMode: document.getElementById('aiResponseMode').value,
        aiConfidence: document.getElementById('aiConfidence').value,
        aiLearning: document.getElementById('aiLearning').checked,
        aiContext: document.getElementById('aiContext').checked,
        aiSuggestions: document.getElementById('aiSuggestions').checked
    };
    
    saveSettings(settings);
    showAlert('success', 'AI settings saved successfully!');
}

function saveNotificationSettings() {
    const settings = {
        emailThreats: document.getElementById('emailThreats').checked,
        emailSystem: document.getElementById('emailSystem').checked,
        emailReports: document.getElementById('emailReports').checked,
        browserThreats: document.getElementById('browserThreats').checked,
        browserSystem: document.getElementById('browserSystem').checked,
        browserUpdates: document.getElementById('browserUpdates').checked,
        alertCritical: document.getElementById('alertCritical').checked,
        alertHigh: document.getElementById('alertHigh').checked,
        alertMedium: document.getElementById('alertMedium').checked
    };
    
    saveSettings(settings);
    showAlert('success', 'Notification settings saved successfully!');
}

function saveSettings(newSettings) {
    const currentSettings = JSON.parse(localStorage.getItem('system_settings') || '{}');
    const updatedSettings = { ...currentSettings, ...newSettings };
    localStorage.setItem('system_settings', JSON.stringify(updatedSettings));
}

function toggleDarkMode(enabled) {
    if (enabled) {
        document.documentElement.setAttribute('data-theme', 'dark');
    } else {
        document.documentElement.removeAttribute('data-theme');
    }
}

function exportSettings() {
    const settings = JSON.parse(localStorage.getItem('system_settings') || '{}');
    const dataStr = JSON.stringify(settings, null, 2);
    const dataBlob = new Blob([dataStr], { type: 'application/json' });
    
    const link = document.createElement('a');
    link.href = URL.createObjectURL(dataBlob);
    link.download = 'cybersecurity_settings.json';
    link.click();
    
    showAlert('info', 'Settings exported successfully!');
}

function importSettings() {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = '.json';
    
    input.onchange = function(e) {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const settings = JSON.parse(e.target.result);
                    localStorage.setItem('system_settings', JSON.stringify(settings));
                    loadSettings();
                    showAlert('success', 'Settings imported successfully!');
                } catch (error) {
                    showAlert('danger', 'Invalid settings file!');
                }
            };
            reader.readAsText(file);
        }
    };
    
    input.click();
}

function resetSettings() {
    if (confirm('Are you sure you want to reset all settings to defaults? This action cannot be undone.')) {
        localStorage.removeItem('system_settings');
        location.reload();
    }
}

function showAlert(type, message) {
    const alertContainer = document.getElementById('alertContainer');
    const alertId = 'alert-' + Date.now();
    
    const alertHTML = `
        <div class="alert alert-${type} alert-dismissible fade show" id="${alertId}" role="alert">
            <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'danger' ? 'exclamation-triangle' : 'info-circle'}"></i>
            ${message}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    `;
    
    alertContainer.insertAdjacentHTML('beforeend', alertHTML);
    
    // Auto-dismiss after 5 seconds
    setTimeout(() => {
        const alert = document.getElementById(alertId);
        if (alert) {
            alert.remove();
        }
    }, 5000);
}
</script>
{% endblock %}
